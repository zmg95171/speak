# Gemini Live API 状态与待修复问题

## 1. 已修复问题 (Fixed)
- [x] **Vite HMR WebSocket 报错**：通过在 `vite.config.ts` 中配置 `allowedHosts: true` 和显式 `protocol: 'wss'`，解决了在反向代理（speak.2068.online）下的热更新连接失败问题。
- [x] **SDK 调用方法错误**：重构 `LiveClient` 为 `callbacks` 模式，解决异步迭代器冲突。
- [x] **模型名对齐 (Critical)**：参考成功案例 `flue`，锁定模型名为 **`gemini-2.5-flash-native-audio-preview-12-2025`**。
- [x] **数据封包格式对齐 (致命伤修复)**：通过分析 `flue` 源码发现，`sendRealtimeInput` 的参数必须是 **`{ media: { data, mimeType } }`** 对象结构，而非之前使用的数组结构。这是导致“有输入无反馈”的根本原因。
- [x] **音频缩放校准**：同步 `flue` 的 `pcm16 = float * 32768` 算法，确保发送的音频振幅足以触发服务端的 VAD（语音激活检测）。
- [x] **连接自动断开 (Error 1000)**：实现在连接成功后立即自动启动麦克风发送数据流，以此作为心跳维持会话活性。

## 2. 核心已知 Bug (Critical Blockers)
### 2.1 采样率适配
- **现象**：当前播放器固定为 `24000Hz`，录音固定为 `16000Hz`。
- **待办**：虽然目前能用，但应考虑从服务端消息中动态提取采样率参数以获得更好的音质兼容性。

## 3. 经验总结 (Insights from "flue" integration)
1. **模型名敏感度**：Live API 对模型名及其权限极其挑剔。特定预览版模型（如 12-2025 后缀）在当前阶段可能比通用版更稳定。
2. **数据封装细节**：Gemini SDK 不同版本间的参数封装格式（对象 vs 数组）存在隐形差异，必须与服务端预期完全匹配，否则会产生没有任何报错的“静默失效”。
3. **连通性判定**：API 的健康检查（REST）通过与否不能代表实时语音（WS）的连通性。

---
**最后更新时间**：2026-02-15 16:35
**当前状态**：实时语音交互通道已全线打通，数据传输格式完全对齐。
